<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Arada Bingo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/styles/style.css">
</head>
<body>
  <div id="gameWrapper">
    <h1>ðŸŽ‰ á‰¢áŠ•áŒŽ áŠ¥áŠ•áŠ³áŠ• á‹°áˆµ áŠ áˆˆá‹Žá‰µ!</h1>
    <div id="userInfo">
      <p>ðŸ‘¤ <span id="userName">Loading...</span></p>
      <p>ðŸ’° Coins: <span id="userCoins">0</span></p>
    </div>
    <div id="cardSelection">
      <label><input type="radio" name="cards" value="1" checked> 1 Card (2 coins)</label>
      <label><input type="radio" name="cards" value="2"> 2 Cards (4 coins)</label>
      <label><input type="radio" name="cards" value="3"> 3 Cards (6 coins)</label>
    </div>
    <button id="startBtn">Start Game</button>
    <div id="gameArea"></div>
    <audio id="winSound" src="/audio/bingo_win.mp3"></audio>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    const userId = tg.initDataUnsafe?.user?.id || 'guest';
    const userName = tg.initDataUnsafe?.user?.first_name || 'Guest';

    document.getElementById('userName').textContent = userName;

    async function fetchCoins() {
      const res = await fetch(`/players/${userId}`);
      const data = await res.json();
      document.getElementById('userCoins').textContent = data.coins;
    }

    document.getElementById('startBtn').onclick = async () => {
      const selected = document.querySelector('input[name="cards"]:checked').value;
      const res = await fetch(`/game/start`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ telegramId: userId, cards: selected })
      });
      const result = await res.json();
      document.getElementById('gameArea').textContent = result.message;
      if (result.win) document.getElementById('winSound').play();
      fetchCoins();
    };

    fetchCoins();
  </script>
</body>
</html>
